<!-- filepath: /e:/Assignment FSD/employee_management_system/employees/templates/employees/employee_list.html -->
{% extends 'employees/base.html' %}

{% block title %}Employee Dashboard{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Employee List</h2>
    <div>
        <span class="badge badge-primary">Total: {{ page_obj.paginator.count }}</span>
        <a href="{% url 'add_employee' %}" class="btn btn-success ml-3">Create Employee</a>
    </div>
</div>

<form method="get" class="form-inline mb-4" id="search-form">
    <input type="text" name="q" class="form-control mr-2" placeholder="Search" value="{{ query }}" id="search-input">
    <select name="filter_by" class="form-control mr-2">
        <option value="">Filter By</option>
        <option value="id" {% if filter_by == 'id' %}selected{% endif %}>ID</option>
        <option value="name" {% if filter_by == 'name' %}selected{% endif %}>Name</option>
        <option value="email" {% if filter_by == 'email' %}selected{% endif %}>Email</option>
        <option value="date_added" {% if filter_by == 'date_added' %}selected{% endif %}>Date Added</option>
    </select>
    <button type="submit" class="btn btn-primary">Search</button>
</form>

<div id="employee-list">
    {% include 'employees/employee_list_partial.html' %}
</div>

<script>
    $(document).ready(function() {
        $('#search-input').on('keyup', function() {
            var query = $(this).val();
            var filter_by = $('select[name="filter_by"]').val();
            $.ajax({
                url: "{% url 'employee_dashboard' %}",
                data: {
                    'q': query,
                    'filter_by': filter_by,
                },
                success: function(data) {
                    $('#employee-list').html(data.html);
                }
            });
        });

        $('select[name="filter_by"]').on('change', function() {
            var query = $('#search-input').val();
            var filter_by = $(this).val();
            $.ajax({
                url: "{% url 'employee_dashboard' %}",
                data: {
                    'q': query,
                    'filter_by': filter_by,
                },
                success: function(data) {
                    $('#employee-list').html(data.html);
                }
            });
        });
    });
</script>
{% endblock %}